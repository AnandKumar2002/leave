import{a as Y,d as U,e as j,f as h}from"./chunk-EP4UQZT6.js";import"./chunk-YWK6GFPS.js";import{a as k,b as W,c as X,h as P}from"./chunk-2OV54QIK.js";import{a as w}from"./chunk-IYQM5MWB.js";import{Ba as s,Gb as M,Hb as F,Ib as N,La as _,Lb as I,Ma as L,Mb as O,Na as m,Qa as i,Ra as o,Sa as E,T as S,Wa as c,Xa as C,cb as d,db as f,eb as u,gb as g,hb as v,ib as y,kb as T,lb as A,nb as D,ob as x}from"./chunk-CVYJNGOA.js";import"./chunk-FK42CRUA.js";U();var V=l=>({"bg-blue-50":l,"hover:bg-gray-100":!0});function q(l,n){if(l&1&&(i(0,"tr",20)(1,"td",21),d(2),o(),i(3,"td",21),d(4),o(),i(5,"td",21),d(6),o(),i(7,"td",21),d(8),D(9,"date"),o(),i(10,"td",21),d(11),D(12,"date"),o(),i(13,"td",21),d(14),o(),i(15,"td",22),d(16,"DONE"),o()()),l&2){let t=n.$implicit,e=n.index,a=C();m("ngClass",A(13,V,e%2!==0)),s(2),f(e+1),s(2),f(t.name),s(2),f(t.leaveType),s(2),u(" ",x(9,7,t.from,"EEE, dd-MM-YYYY")," "),s(3),u(" ",x(12,10,t.to,"EEE, dd-MM-YYYY")," "),s(3),u(" ",a.calculateLeaveDays(t.from,t.to)," ")}}function z(l,n){l&1&&(i(0,"tr")(1,"td",23),d(2," No approved leaves found "),o()())}var B=class l{approvedLeaves=[];searchQuery="";startDate="";endDate="";currentDateTime="";constructor(){}ngOnInit(){this.fetchApprovedLeaves(),this.updateDateTime(),setInterval(()=>{this.updateDateTime()},6e4)}updateDateTime(){let n=new Date;this.currentDateTime=n.toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})}get filteredApprovedLeaves(){let n=this.approvedLeaves.filter(t=>t.name.toLowerCase().includes(this.searchQuery.toLowerCase()));if(this.startDate&&this.endDate){let t=new Date(this.startDate),e=new Date(this.endDate);n=n.filter(a=>{let r=new Date(a.from),p=new Date(a.to);return r>=t&&r<=e||p>=t&&p<=e})}return n}fetchApprovedLeaves(){this.approvedLeaves=w.users.flatMap(n=>n.leaveApplications.filter(t=>t.status==="Approved").map(t=>({name:n.name,from:t.from,to:t.to,leaveType:t.type})))}calculateLeaveDays(n,t){let e=w.publicHolidays,a=new Date(n),r=new Date(t),p=new Date(a),b=0;for(;p<=r;){let Q=p.getDay(),H=this.isHoliday(p,e),R=this.isSecondSaturday(p);Q!==0&&!H&&!R&&b++,p.setDate(p.getDate()+1)}return b}isHoliday(n,t){for(let e of t){let a=new Date(e.startDate),r=new Date(e.endDate);if(n>=a&&n<=r)return!0}return!1}isSecondSaturday(n){let a=(6-new Date(n.getFullYear(),n.getMonth(),1).getDay()+7)%7+1+7;return n.getDate()===a}onFromDateChange(){this.startDate&&(this.endDate||(this.endDate=this.startDate))}exportToPDF(){let n=new Y,t=this.filteredApprovedLeaves.map((e,a)=>[a+1,e.name,e.leaveType,e.from,e.to,this.calculateLeaveDays(e.from,e.to),e.status]);n.text("Approved Leaves",20,10),n.autoTable({head:[["SR NO.","Name","Leave Type","From","To","No. of Days","Approve"]],body:t}),n.save("approved_leaves.pdf")}exportToExcel(){let n=this.filteredApprovedLeaves.map((a,r)=>({"SR NO.":r+1,Name:a.name,"Leave Type":a.leaveType,From:a.from,To:a.to,"No. of Days":this.calculateLeaveDays(a.from,a.to),Approve:a.status})),t=h.json_to_sheet(n),e=h.book_new();h.book_append_sheet(e,t,"Approved Leaves"),j(e,"approved_leaves.xlsx")}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=S({type:l,selectors:[["app-approved-leaves"]],standalone:!0,features:[T],decls:39,vars:8,consts:[[1,"p-4","md:p-8","bg-gray-100"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","md:text-2xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-600","shadow-md","rounded-lg","bg-white","p-2","cursor-pointer"],[1,"fa-solid","fa-calendar-days"],[1,"flex","flex-wrap","gap-2","justify-between","mb-4"],[1,"flex","justify-between","w-full","sm:w-auto"],["type","text","placeholder","Search by name...",1,"border","border-gray-300","p-2","rounded-md","w-full","md:w-1/3","flex-1",3,"ngModelChange","ngModel"],[1,"flex","gap-2","w-full","sm:w-auto","justify-between"],["type","date",1,"border","border-gray-300","p-2","rounded-md","w-full",3,"ngModelChange","change","ngModel"],["type","date",1,"border","border-gray-300","p-2","rounded-md","w-full",3,"ngModelChange","ngModel","disabled"],[1,"flex","justify-between","gap-2","mb-4"],[1,"bg-blue-500","text-white","py-2","px-4","rounded-md","shadow-md","hover:bg-blue-600",3,"click"],[1,"bg-green-500","text-white","py-2","px-4","rounded-md","shadow-md","hover:bg-green-600",3,"click"],[1,"overflow-x-auto","bg-white","shadow-lg","rounded-lg","max-w-full",2,"max-height","550px"],["id","approved-leaves-table",1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-200"],[1,"py-2","px-4","text-left","font-semibold","text-gray-700","text-center"],[3,"ngClass",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass"],[1,"py-2","px-4","border-b","text-center"],[1,"py-2","px-4","border-b","text-center","text-green-500"],["colspan","7",1,"py-2","px-4","text-center","text-gray-500"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1)(2,"p",2),d(3," Approved Leaves "),o(),i(4,"p",3),E(5,"i",4),d(6),o()(),i(7,"div",5)(8,"div",6)(9,"input",7),y("ngModelChange",function(r){return v(e.searchQuery,r)||(e.searchQuery=r),r}),o()(),i(10,"div",8)(11,"input",9),y("ngModelChange",function(r){return v(e.startDate,r)||(e.startDate=r),r}),c("change",function(){return e.onFromDateChange()}),o(),i(12,"input",10),y("ngModelChange",function(r){return v(e.endDate,r)||(e.endDate=r),r}),o()()(),i(13,"div",11)(14,"button",12),c("click",function(){return e.exportToPDF()}),d(15," Export to PDF "),o(),i(16,"button",13),c("click",function(){return e.exportToExcel()}),d(17," Export to Excel "),o()(),i(18,"div",14)(19,"table",15)(20,"thead",16)(21,"tr")(22,"th",17),d(23," SR NO. "),o(),i(24,"th",17),d(25," Name "),o(),i(26,"th",17),d(27," Leave Type "),o(),i(28,"th",17),d(29," From "),o(),i(30,"th",17),d(31," To "),o(),i(32,"th",17),d(33," No. of Days "),o(),i(34,"th",17),d(35," Approve "),o()()(),i(36,"tbody"),_(37,q,17,15,"tr",18)(38,z,3,0,"tr",19),o()()()()),t&2&&(s(6),u(" ",e.currentDateTime," "),s(3),g("ngModel",e.searchQuery),s(2),g("ngModel",e.startDate),s(),g("ngModel",e.endDate),m("disabled",!e.startDate),L("min",e.startDate),s(25),m("ngForOf",e.filteredApprovedLeaves),s(),m("ngIf",e.filteredApprovedLeaves.length===0))},dependencies:[O,M,F,N,I,P,k,W,X]})};export{B as ApprovedLeavesComponent};
