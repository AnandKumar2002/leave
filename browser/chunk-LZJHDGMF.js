import{b as F}from"./chunk-OHW2K2PL.js";import"./chunk-FFNQQ6S7.js";import"./chunk-YT63TBDZ.js";import{a as U}from"./chunk-IYQM5MWB.js";import{$ as E,Ba as s,Ca as w,Gb as M,Hb as H,Ib as I,La as y,Lb as A,Mb as O,Na as f,Qa as a,Ra as i,Sa as m,T as S,Ua as C,Wa as u,Xa as v,aa as T,cb as o,db as h,eb as p,kb as L,lb as k,nb as g,ob as b}from"./chunk-CVYJNGOA.js";import"./chunk-FK42CRUA.js";var P=l=>({"bg-blue-50":l,"hover:bg-gray-100":!0});function z(l,t){if(l&1&&(a(0,"tr",25)(1,"td",26)(2,"span",27),o(3),i()(),a(4,"td",26),o(5),g(6,"date"),i(),a(7,"td",26),o(8),g(9,"date"),i(),a(10,"td",26),o(11),i()()),l&2){let e=t.$implicit,n=t.index,r=v(3);f("ngClass",k(11,P,n%2!==0)),s(3),h(e.name),s(2),p(" ",b(6,5,e.startDate,"EEE, dd MMM, yyyy")," "),s(3),p(" ",b(9,8,e.endDate,"EEE, dd MMM, yyyy")," "),s(3),p(" ",r.calculateDays(e.startDate,e.endDate)," ")}}function R(l,t){if(l&1&&(a(0,"div")(1,"table",21)(2,"thead",22)(3,"tr")(4,"th",23),o(5,"Holiday Name"),i(),a(6,"th",23),o(7,"Start Date"),i(),a(8,"th",23),o(9,"End Date"),i(),a(10,"th",23),o(11,"No. of Days"),i()()(),a(12,"tbody"),y(13,z,12,13,"tr",24),i()()()),l&2){let e=v(2);s(13),f("ngForOf",e.publicHolidays)}}function V(l,t){if(l&1){let e=C();a(0,"div",14)(1,"div",15)(2,"button",16),u("click",function(){E(e);let r=v();return T(r.closeModal())}),m(3,"i",17),i(),a(4,"div",18)(5,"h3",19),o(6,"Public Holidays"),i()(),y(7,R,14,1,"div",20),i()()}if(l&2){let e=v();s(7),f("ngIf",e.modalType==="publicHolidays")}}var N=class l{constructor(t){this.router=t}currentDateTime="";data=U;totalUsers=0;totalLeaves=0;totalTakenLeaves=0;totalApprovedLeaveDays=0;approvedLeaves=[];publicHolidaysCount=0;publicHolidays=[];isModalOpen=!1;modalType="";ngOnInit(){this.updateDateTime(),this.calculateDashboardStats(),this.fetchPublicHolidays(),setInterval(()=>{this.updateDateTime()},6e4)}updateDateTime(){let t=new Date;this.currentDateTime=t.toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})}calculateDashboardStats(){this.totalUsers=this.data.users.length,this.totalLeaves=this.data.users.reduce((t,e)=>t+e.yearlyTotalLeaves,0),this.totalTakenLeaves=this.data.users.reduce((t,e)=>t+e.CL_Taken+e.ML_Taken+e.EL_Taken,0),this.totalApprovedLeaveDays=this.data.users.reduce((t,e)=>{let n=e.leaveApplications.filter(r=>r.status==="Approved").reduce((r,d)=>r+this.calculateApprovedLeaveDays(d.from,d.to),0);return t+n},0),this.approvedLeaves=this.data.users.flatMap(t=>t.leaveApplications.filter(e=>e.status==="Approved").map(e=>({name:t.name,from:e.from,to:e.to}))),this.publicHolidaysCount=this.data.publicHolidays.length}fetchPublicHolidays(){this.publicHolidays=this.data.publicHolidays}redirectToUsers(){this.router.navigate(["/users"])}openModal(t){this.modalType=t,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1}redirectToApprovedLeaves(){this.router.navigate(["/approved-leaves"])}calculateApprovedLeaveDays(t,e){let n=this.data.publicHolidays,r=new Date(t),d=new Date(e),c=new Date(r),x=0;for(;c<=d;){let D=c.getDay();console.log(D);let _=this.isHoliday(c,n);console.log(_);let j=this.isSecondSaturday(c);D!==0&&!_&&!j&&x++,c.setDate(c.getDate()+1)}return x}isHoliday(t,e){for(let n of e){let r=new Date(n.startDate),d=new Date(n.endDate);if(t>=r&&t<=d)return!0}return!1}isSecondSaturday(t){let r=(6-new Date(t.getFullYear(),t.getMonth(),1).getDay()+7)%7+1+7;return t.getDate()===r}calculateDays(t,e){let n=new Date(t);return(new Date(e).getTime()-n.getTime())/(1e3*3600*24)+1}static \u0275fac=function(e){return new(e||l)(w(F))};static \u0275cmp=S({type:l,selectors:[["app-dashboard"]],standalone:!0,features:[L],decls:37,vars:6,consts:[[1,"p-4","md:p-8","bg-gray-100"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","md:text-2xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-600","shadow-md","rounded-lg","bg-white","p-2","flex","items-center","cursor-pointer"],[1,"fa-solid","fa-calendar-days","mr-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"bg-white","p-6","rounded-lg","shadow-lg","cursor-pointer",3,"click"],[1,"text-xl","font-semibold"],[1,"fa-solid","fa-users","text-2xl","text-blue-500"],[1,"text-gray-600","text-2xl","font-bold"],[1,"fa-solid","fa-calendar-day","text-2xl","text-orange-500"],[1,"fa-solid","fa-check-circle","text-2xl","text-green-500"],[1,"fa-solid","fa-sun","text-2xl","text-yellow-500"],["class","fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-50",4,"ngIf"],[1,"fixed","inset-0","bg-gray-800","bg-opacity-50","flex","justify-center","items-center","z-50"],[1,"bg-white","rounded-lg","p-4","sm:p-6","md:p-8","w-full","max-w-xl","mx-4","relative","overflow-x-auto",2,"max-height","550px","height","auto","overflow-y","auto"],[1,"absolute","top-5","right-5","h-7","w-7","flex","items-center","justify-center","bg-red-600","text-white","hover:bg-red-500","rounded-full","transition-colors","duration-300","z-50",3,"click"],[1,"fa-solid","fa-xmark"],[1,"flex","justify-center","items-center","mb-4"],[1,"text-xl","font-semibold","uppercase"],[4,"ngIf"],["id","public-holidays-table",1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-200"],[1,"border-b","px-4","py-2","text-center"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"border-b","px-4","py-2"],[1,"font-medium"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"p",2),o(3,"Dashboard"),i(),a(4,"p",3),m(5,"i",4),o(6),i()(),a(7,"div",5)(8,"div",6),u("click",function(){return n.redirectToUsers()}),a(9,"div",1)(10,"h3",7),o(11,"Total Users"),i(),m(12,"i",8),i(),a(13,"p",9),o(14),i()(),a(15,"div",6),u("click",function(){return n.redirectToUsers()}),a(16,"div",1)(17,"h3",7),o(18,"Total Leaves"),i(),m(19,"i",10),i(),a(20,"p",9),o(21),i()(),a(22,"div",6),u("click",function(){return n.redirectToApprovedLeaves()}),a(23,"div",1)(24,"h3",7),o(25,"Approved Leaves"),i(),m(26,"i",11),i(),a(27,"p",9),o(28),i()(),a(29,"div",6),u("click",function(){return n.openModal("publicHolidays")}),a(30,"div",1)(31,"h3",7),o(32,"Public Holidays"),i(),m(33,"i",12),i(),a(34,"p",9),o(35),i()()(),y(36,V,8,1,"div",13),i()),e&2&&(s(6),p(" ",n.currentDateTime," "),s(8),h(n.totalUsers),s(7),p(" ",n.totalTakenLeaves+n.totalApprovedLeaveDays," "),s(7),p(" ",n.approvedLeaves.length," "),s(7),h(n.publicHolidaysCount),s(),f("ngIf",n.isModalOpen))},dependencies:[O,M,H,I,A]})};export{N as DashboardComponent};
